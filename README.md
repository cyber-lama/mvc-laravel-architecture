# mvc-laravel-architecture

## Database

Изначально желательно нарисовать схему работы бд, например с помощью https://app.diagrams.net/

1. Database
   1. Migrations
   2. Factories
   3. Seeders
   4. Models

Migrations - система контроля версий для нашей базы данных. Они позволяют изменять структуру БД, в то же время оставаясь в курсе изменений других участников.
```php
php artisan make:migration create_flights_table
```

Factories - при тестировании нам может потребоваться вставить несколько записей в вашу базу данных перед выполнением теста. Вместо того, чтобы вручную указывать значение каждого столбца при создании этих тестовых данных, Laravel позволяет вам определять набор атрибутов по умолчанию для каждой из ваших моделей Eloquent, используя фабрики моделей.
```php
php artisan make:factory PostFactory
```

Seeders - Laravel имеет простой метод заполнения базы данных тестовыми данными, используя классы-наполнители(seed classes). Эти классы хранятся в database/seeds. Можно использовать любое имя для названия класса-наполнителя, но разумным будет применять имена, подобные UsersTableSeeder.

Models - При использовании Eloquent (ORM) каждая таблица БД имеет соответствующую «Модель», которая используется для взаимодействия с этой таблицей. Помимо получения записей из таблицы БД, модели Eloquent также позволяют вставлять, обновлять и удалять записи из таблицы. В модели мы можем описывать дополнительную логику, которая связана с работой модели и базы данных.
```php
php artisan make:model Flight --migration // модель с миграцией
```

## Tests

Работа над приложением, после разметки бд, желательно, должна начинаться с написания тестов.

Feature - Функциональные тесты могут тестировать большую часть вашего кода, включая взаимодействие нескольких объектов друг с другом, или даже целый HTTP-запрос, возвращающий JSON. Как правило, большинство ваших тестов должны быть функциональными. Эти типы тестов обеспечивают максимальную уверенность в том, что ваша система в целом работает должным образом.
```php
php artisan make:test UserTest
```

Unit - Модульные (юнит) тесты – это тесты, которые фокусируются на очень небольшой изолированной части вашего кода. Фактически, большинство модульных тестов, вероятно, сосредоточены на одном методе. Тесты в каталоге «Unit» тестов не загружают ваше приложение Laravel и, следовательно, не могут получить доступ к базе данных вашего приложения или другим службам фреймворка.

```php
php artisan make:test UserTest --unit
```

## Routes

Все маршруты Laravel должны быть определены в файлах маршрутов, находящихся в вашем каталоге routes. Эти файлы автоматически загружаются вашим поставщиком App\Providers\RouteServiceProvider приложения. Файл routes/web.php определяет маршруты для вашего веб-интерфейса. Этим маршрутам назначается группа посредников web, которая обеспечивает такие функции, как состояние сессии и защита от CSRF. Маршруты в routes/api.php не сохраняют состояния и им назначается группа посредников api.

## Middleware

HTTP Middleware (посредники) - это фильтры обработки HTTP-запроса. Так, например, в Laravel включены middlewares для проверки аутентификации пользователя. Если пользователь не залогинен, middleware перенаправляет его на страницу логина. Если же залогинен - middleware не вмешивается в прохождение запроса, передавая его дальше по цепочке middleware-посредников к собственно приложению.

## Controllers 

Вместо того, чтобы определять всю логику обработки запросов как замыкания в файлах маршрутов, вы можете организовать это поведение с помощью классов «контроллеров». Контроллеры могут сгруппировать связанную логику обработки запросов в один класс. Например, класс UserController может обрабатывать все входящие запросы, относящиеся к пользователям, включая отображение, создание, обновление и удаление пользователей. По умолчанию контроллеры хранятся в каталоге app/Http/Controllers.

## Service Providers

Service providers (сервис-провайдеры, дословно - «поставщики услуг») занимают центральное место в архитектуре Laravel. Они предназначены для первоначальной загрузки (bootstraping) приложения. Ваше приложение, а также сервисы самого фреймворка загружаются через сервис-провайдеры.

## Services

Services нужен, чтобы в сервис контейнере уже лежал экземпляр нашего Service, и чтобы это был единственный инстанс ($this->app->singleton). Теперь, если в любом месте приложения мы попытаемся дернуть что-то с именем нашего сервисв, то нам вернется уже созданный объект из контейнера зависимостей.


